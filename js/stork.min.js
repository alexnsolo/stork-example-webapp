(function(){var t,n,e,i,r,o,s,u,l,a,p,c,h,f,_,m,g,d,v,y,b,w,k,S,E,x,j,q,C,O,R=[].slice,z={}.hasOwnProperty,T=function(t,n){function e(){this.constructor=t}for(var i in n)z.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},P=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};!function(t){var n,e,i,r,o,s,u,l,a;for(u=["memory"],i=0,o=u.length;o>i;i++)e=u[i],null==t[e]&&(t[e]={});for(l=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],a=[],r=0,s=l.length;s>r;r++)n=l[r],a.push(null!=t[n]?t[n]:t[n]=function(){});return a}(this.console=null!=(C=this.console)?C:{}),null==(q=Function.prototype).bind&&(q.bind=function(t){var n,e,i,r;if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return n=Array.prototype.slice.call(arguments,1),i=this,r=function(){},e=function(){var e;return e=this instanceof r&&t?this:t,i.apply(e,n.concat(Array.prototype.slice.call(arguments)))},r.prototype=this.prototype,e.prototype=new r,e}),u=function(t){var n,e,i,r,o;for(e={},r=0,o=t.length;o>r;r++)n=t[r],e[n]=!0;return function(){var t;t=[];for(n in e)i=e[n],t.push(n);return t}()},s=function(t,n){var e,i,r,o;if(!c(t))return[];for(c(n)||(n=[n]),i=0,o=n.length;o>i;i++)e=n[i],t=function(){var n,i,o;for(o=[],n=0,i=t.length;i>n;n++)r=t[n],r!==e&&o.push(r);return o}();return t},v=function(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)},m=function(t){return null!=t&&"[object Function]"===Object.prototype.toString.call(t)},h=function(t){return null!=t&&"[object Boolean]"===Object.prototype.toString.call(t)},c=function(t){return null!=t&&"[object Array]"===Object.prototype.toString.call(t)},b=function(t){return null!=t&&"[object String]"===Object.prototype.toString.call(t)},d=function(t){return null!=t&&"[object Number]"===Object.prototype.toString.call(t)},g=function(t){return d(t)&&t!==t},_=function(t){var n,e;if(null==t)return!0;if(b(t))return 0===j(t).length;if(c(t))return 0===t.length;if(v(t)){for(n in t)return e=t[n],!1;return!0}return!1},f="object"==typeof HTMLElement?function(t){return t instanceof HTMLElement}:function(t){return null!=t&&1===t.nodeType&&"string"==typeof t.nodeName},y=function(){var t;return t=null,function(){var n;return null!=t?t:(n=navigator.userAgent||navigator.vendor||window.opera,t=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(n),t||(t=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))),t)}}(),w=function(t){var n,e;e=[];for(n in t)e.push(n);return e},a=function(t,n){var e,i;null==t&&(t={}),v(n)||(n={});for(e in n)i=n[e],t[e]=i;return t},p=function(t,n){var e,i;for(e in t)if(i=t[e],i===n)return e;return void 0},l=function(t){var n,e,i;if(!v(t))return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return n="",null!=t.global&&(n+="g"),null!=t.ignoreCase&&(n+="i"),null!=t.multiline&&(n+="m"),null!=t.sticky&&(n+="y"),new RegExp(t.source,n);i=new t.constructor;for(e in t)i[e]=l(t[e]);return i},j=String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")},x=function(t,n){return 0===t.indexOf(n)},n=function(){function n(){}return n.prototype.__events__=null,n.prototype.__listeners__=null,n.prototype.__simulations__=null,n.prototype.is_simulating=!1,n.prototype.on=function(t,n,e){var i,r,o;if(v(t)){for(i in t)r=t[i],this.on(i,r);return this}return b(t)&&m(n)?(null==e&&(e=this),t=j(t),_(t)?this:(null==this.__events__&&(this.__events__={}),(null!=(o=this.__events__)[t]?o[t]:o[t]=[]).push({callback:n,context:e}),this)):this},n.prototype.off=function(t,n){var e;return b(t)?(null==this.__events__&&(this.__events__={}),t=j(t),_(t)||null==this.__events__[t]?this:(m(n)?(this.__events__[t]=function(){var i,r,o,s;for(o=this.__events__[t],s=[],i=0,r=o.length;r>i;i++)e=o[i],e.callback!==n&&s.push(e);return s}.call(this),this.__events__[t].length<=0&&(this.__events__[t]=null)):this.__events__[t]=null,this)):this},n.prototype.trigger=function(){var t,n,e,i,r,o;if(n=arguments[0],t=2<=arguments.length?R.call(arguments,1):[],!b(n))return this;if(n=j(n),null==this.__events__&&(this.__events__={}),_(n)||null==this.__events__[n])return this;for(o=this.__events__[n],i=0,r=o.length;r>i;i++)e=o[i],e.callback.apply(e.context,t);return this},n.prototype.listenTo=function(t,e,i){var r,o;if(v(e)){for(r in e)o=e[r],this.listenTo(t,r,o);return this}return t instanceof n&&b(e)&&m(i)?(t.on(e,i,this),(null!=this.__listeners__?this.__listeners__:this.__listeners__=[]).push({object:t,event:e,callback:i}),this):this},n.prototype.stopListening=function(e,i,r){var o,s,u,l,a,p,c,h,f,_,g;for(b(e)&&(h=[e,i,null],i=h[0],r=h[1],e=h[2]),m(e)&&(f=[e,null],r=f[0],e=f[1]),m(i)&&(_=[i,null],r=_[0],i=_[1]),l=b(i)?i:null,c=e instanceof n?e:null,u=m(r)?r:null,s=[],g=null!=this.__listeners__?this.__listeners__:this.__listeners__=[],a=0,p=g.length;p>a;a++)o=g[a],e=o.object,i=o.event,r=o.callback,null!=l&&i!==l?s.push(o):null!=c&&e!==c?s.push(o):null!=u&&r!==u?s.push(o):e.off(i,r);return this.__listeners__=s,t},n.prototype.hasSimulation=function(t){return b(t)?t in this.__simulations__:!1},n.prototype.simulation=function(t,n){var e,i;if(v(t)){for(e in t)i=t[e],m(i)&&this.simulation(e,i);return this}if(!b(t))throw new Error("Event must be a string");return null==this.__simulations__&&(this.__simulations__={}),m(n)?(null!=this.__simulations__[t]&&delete this.__simulations__[t],this.__simulations__[t]=new o(this,n),this):this.__simulations__[t]},n.prototype.simulate=function(){return this.is_simulating?this:(this.is_simulating=!0,this.trigger("simulate"),this)},n.prototype.restore=function(){return this.is_simulating?(this.is_simulating=!1,this.trigger("restore"),this):this},n}(),e=function(n){function e(t,n){if(!b(t))throw new Error("Name must be a string");return this.name=t,v(n)||(n={}),this.defineProperty(n),this}return T(e,n),e.prototype.name=null,e.prototype.defineProperty=function(t,n,e){var i,r,o;if(v(t)){for(i in t)o=t[i],this.defineProperty(i,o);return this}if(v(n)){r={};for(i in n)o=n[i],r[i]=o}else r=c(n)?function(){var t,e,r;for(r=[],t=0,e=n.length;e>t;t++)i=n[t],r.push(i);return r}():n;return this[t]=r,m(e)&&this.simulation(t,e),this},e.prototype.send=function(n,e){var r;return r=new i(this.name,n,e),(t.is_simulating||this.is_simulating)&&this.hasSimulation(n)?this.simulation(n).send(r):r.send(),r},e}(n),i=function(t){function n(t,n,e){if(!b(n))throw new Error("Event must be defined");this.id=(i++).toString(),this.plugin=t,this.event=n,this.request_data=e}var e,i,r;return T(n,t),r="stork://",i=0,e={},n.all=function(){return e},n.lookup=function(t){return b(t)?e[t]:null},n.cache=function(t){if(!(t instanceof n))throw new Error("request must be an instanceof Stork.Request");return e[t.id]=t},n.prototype.id=null,n.prototype.plugin=null,n.prototype.event=null,n.prototype.request_data=null,n.prototype.standardizedRequestData=function(){var t;return v(this.request_data)?t=this.request_data:(console.warn("Request Data must be an object"),t={})},n.prototype.send=function(){var t,e,i;return i=this.standardizedRequestData(),t=JSON.stringify({id:this.id,plugin:this.plugin,event:this.event,request_data:i}),e=document.createElement("iframe"),e.setAttribute("src",""+r+t),e.style.position="absolute",e.style.zIndex="-1",e.style.top="-1000px",e.style.left="-1000px",e.style.height="1px",e.style.width="1px",document.documentElement.appendChild(e),e.parentNode.removeChild(e),e=null,n.cache(this),this},n.prototype.dispose=function(){return this.id in e?(delete e[this.id],this):this},n.prototype.hasSimulation=void 0,n.prototype.simulation=void 0,n}(n),r=function(t){function n(t){var n;if(!v(t))throw new Error("Response must be an object");if(n=t.status,P.call(e,n)<0)throw new Error("Invalid response status '"+t.status+"'");this.id=t.id,this.event=t.event,this.status=t.status,this.plugin=t.plugin,this.request_data=t.request_data,this.response_data=t.response_data}var e;return T(n,t),n.SUCCESS="success",n.ERROR="error",n.CANCEL="cancel",n.COMPLETE="complete",e=[n.SUCCESS,n.ERROR,n.CANCEL],n.prototype.id=null,n.prototype.event=null,n.prototype.status=null,n.prototype.plugin=null,n.prototype.request_data=null,n.prototype.response_data=null,n.prototype.finalize=function(){var t;return null==this.id?this:(t=i.lookup(this.id),t instanceof i?(t.trigger(this.status,this.response_data,this),t.trigger(n.COMPLETE,this.response_data,this),t.dispose(),this):this)},n.prototype.hasSimulation=void 0,n.prototype.simulation=void 0,n}(n),o=function(){function n(t,n){if(!m(n))throw new Error("callback must be a function");this.plugin=t,this.callback=n}return n.prototype.callback=null,n.prototype.plugin=null,n.prototype.send=function(n){return i.cache(n),this.execute(n,function(){return function(e,i){return t.receive({id:n.id,plugin:n.plugin,event:n.event,status:e,request_data:n.request_data,response_data:i})}}(this))},n.prototype.trigger=function(n){return this.execute(null,function(i){return function(r,o){return t.receive({id:null,plugin:i.plugin instanceof e?i.plugin.name:null,event:n,status:r,request_data:null,response_data:o})}}(this))},n.prototype.execute=function(t,n){return setTimeout(function(e){return function(){return 1===e.callback.length?e.callback.call(e.plugin,n):e.callback.call(e.plugin,t,n)}}(this)),this},n}(),t=new(function(n){function s(){return s.__super__.constructor.apply(this,arguments)}var u;return T(s,n),u={},s.prototype._simulatedConfiguration=null,s.prototype.version="0.0.4",s.prototype.singleton="Stork",s.prototype.Request=i,s.prototype.Response=r,s.prototype.Plugin=e,s.prototype.Simulation=o,s.prototype.deliver=function(t){return this.send("deliver",{singleton:this.singleton}).on({complete:function(n){return m(t)?t(n.configuration):void 0}}),this},s.prototype.send=function(t,n){var e;return e=new i(null,t,n),this.is_simulating&&this.hasSimulation(t)?this.simulation(t).send(e):e.send(),e},s.prototype.receive=function(n){var e,i,o;return o=new r(n),o.finalize(),e=o.event,null!=o.plugin&&(i=u[o.plugin],null==i?t.warn("[Stork] Plugin '"+o.plugin+"' does not exist"):(i.trigger(e,o.status,o.response_data,o),e=""+i.name+":"+e)),this.trigger(e,o.status,o.response_data,o),this},s.prototype.plugin=function(t,n){var i;if(!b(t))throw new Error("Plugin name must be a string");return v(n)&&(i=new e(t,n),this.is_simulating&&(i.simulate(),this.trigger(""+i.name+":simulate")),u[t]=i),u[t]},s.prototype.simulate=function(t){var n,e;if(this.is_simulating)return this;this._simulatedConfiguration=t,s.__super__.simulate.call(this);for(n in u)e=u[n],e.simulate(),this.trigger(""+e.name+":simulate");return this},s.prototype.restore=function(){var t,n;if(!this.is_simulating)return this;for(t in u)n=u[t],n.restore(),this.trigger(""+n.name+":restore");return s.__super__.restore.call(this),this},s.prototype.isOnMobileDevice=function(){return y()},s.prototype.simulateIfOnDesktop=function(t){return this.isOnMobileDevice()||this.simulate(t),this},s}(n)),t.simulation({deliver:function(n){return console.log("[Stork] deliver"),n(t.Response.SUCCESS,{configuration:t._simulatedConfiguration})}}),S=window.document.getElementsByTagName("script"),k=S[S.length-1],E=j((null!=(O=k.getAttribute("data-singleton"))?O:"Stork").toString()),_(E)&&(E="Stork"),t.singleton=E,this[E]=t}).call(this);